---
title: "Week 9 Homework"
output: html_document
date: "2025-10-21"
author: "YOUR NAME" 
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(glmmTMB)
library(DHARMa)
library(performance)
library(ggeffects)
library(dagitty)
library(ggdag)
```

## Introduction

This week, weâ€™ll apply our regression and causal reasoning skills to real data from the **Mara Hyena Project**.

Your task:
1. Formulate a research question and hypotheses.
2. Draw a DAG to represent your causal assumptions.
3. Explore your data visually.
4. Build at least two models â€” a simple model and a fuller model â€” and interpret your results.
5. Conclude whether you reject or fail to reject your null hypothesis.

---

## 1. Load and Inspect the Data

```{r}
load("hyenas.RData")
glimpse(hyenas)
summary(hyenas)
```

**Questions to answer here:**
- What kinds of variables do we have (continuous, categorical, date)?
- Which variable might you use as your **response**?
- Which might be **predictors**?

---

## 2. Define Your Research Question

Write a short paragraph describing:
- What question you want to ask about hyena life history or social behavior.  
- Your **hypothesis** and **null hypothesis**.

> ðŸ§  Example:  
> *Does maternal rank predict age at weaning?*  
> - Hâ‚€: Maternal rank has no effect on age at weaning.  
> - Hâ‚: Higher-ranked mothers have younger weaning ages.
> - Number of litter mates and age at den graduation might also influence age at weaning. 

--- 

## 3. Explore Your Data

Pick your **response** and one or more **predictors** from the DAG. Fill in the template code with your variables.

```{r}

# Basic scatterplot or boxplot
ggplot(hyenas, aes(x = .data[[predictor1]], y = .data[[response]])) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  theme_minimal()

# Check distribution of response variable
hist(hyenas[[response]], main=paste("Distribution of", response), xlab=response)

# Check for outliers
boxplot(hyenas[[response]], main="Boxplot of response variable")
```

**Questions to answer:**
- Is your response variable normal, skewed, or has outliers?  
- Should it be transformed (e.g., log)?  

---

## 4. Model 1: Simple Regression

Your first model should include **only one predictor** that you believe directly affects the response.

```{r}
m1 <- glmmTMB(response ~ predictor1, data = hyenas)
summary(m1)
simulateResiduals(m1, plot = TRUE)
r2(m1)
```

Interpret:
- What is the direction of the effect?
- What does the p-value tell you?
- How much variation does this model explain?

---

## 5. Check Other 1:1 Relationships in Your DAG

To better understand the causal structure, check other key links. 

Briefly explain:
- Which variables you included and why.  
- Which paths represent **direct** vs **indirect** effects.

```{r}
# Plot your DAG
dag <- dagitty("dag {
  Response <- Predictor1
  Response <- Predictor2
}")
ggdag(dag) + theme_dag()


# Example: predictor1 ~ predictor2
m2 <- glmmTMB(predictor1 ~ predictor2, data=hyenas)
summary(m2)


```

What might this tell you about confounding or mediation?

---

## 6. Model 2: Multiple Regression

Now create your **full model**, including the response and multiple predictors based on your DAG.

```{r}
#Model Code Here: 
m3 <- glmmTMB(response ~ predictor1 + predictor2, data=hyenas)
summary(m3)


# Model diagnostics
simulateResiduals(m3, plot = TRUE) #check 
check_collinearity(m3)
r2(m3)
```

**Interpret:**
- Is the model fit adequate? (residuals, collinearity, r2)?
- How did adding predictors change the coefficients or p-values?  
- What does this suggest about the relationships? 

---

## 7. Visualize Model Predictions

```{r}
# Example predicted relationship (with categorial predictor 2)
ggplot(hyenas, aes(x = predictor1, y = response), color = predictor2) +
  geom_point(alpha = 0.6) +
  geom_line(data = ggpredict(m3, terms = c(predictor1, predictor2)), 
            aes(x, predicted, color = group), size = 1.2) +
  theme_minimal()
```

---

## 9. Interpret and Conclude

In a few sentences:
- Summarize your main findings (effect direction, p-value, and effect size).  
- Discuss whether you **reject or fail to reject** the null hypothesis.  
- Mention any **limitations** (non-normal data, missing values, etc).  
- Reflect briefly on how your DAG helped interpret your model results.

> Example structure:
> - "Maternal rank had a significant negative effect on age at weaning (p < 0.01), meaning higher-ranked females weaned their offspring earlier. When controlling for sex, the effect remained strong. I reject the null hypothesis that rank has no effect on weaning age."

---

## 10. Compare Models with AIC

```{r}
AIC(m1, m2, m3)
```

Which model fits better? Does it align with your causal reasoning?

---

## Wrap-up

1. Knit your file to .html
2. Put both files in your git repo folder 
3. Use 'git pull' to download any changes from github.com
4. Use 'git add filename' to add them to git tracking
5. Use 'git commit -m "comment"' to commit them for upload
6. Use 'git push' to upload your changes from github.com 
